<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Media Subtitler Pro | Vid√©o & Audio</title>
    <style>
        :root {
            --primary: #8b5cf6;
            --secondary: #ec4899;
            --bg-dark: #0f0c29;
            --card-bg: rgba(30, 27, 75, 0.7);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, var(--bg-dark), #302b63, #24243e);
            color: white;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
        }

        .container { width: 100%; max-width: 900px; z-index: 1; }

        .card {
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            padding: 40px;
            border-radius: 24px;
            border: 1px solid rgba(139, 92, 246, 0.2);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        h1 {
            font-size: 2.2rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
            text-align: center;
        }

        .subtitle { color: #a0a0c8; text-align: center; margin-bottom: 30px; }

        /* Zone de t√©l√©chargement */
        .upload-section {
            border: 2px dashed var(--primary);
            padding: 40px;
            border-radius: 16px;
            text-align: center;
            background: rgba(20, 18, 50, 0.3);
            cursor: pointer;
            transition: 0.3s;
            margin-bottom: 25px;
        }

        .upload-section:hover { background: rgba(20, 18, 50, 0.5); border-color: var(--secondary); }
        
        .file-info { margin-top: 10px; font-weight: bold; color: var(--secondary); }

        /* S√©lecteur de langue */
        .config-grid {
            display: grid;
            gap: 20px;
            margin-bottom: 25px;
        }

        select {
            width: 100%;
            padding: 12px;
            border-radius: 12px;
            background: #1a1a3a;
            color: white;
            border: 1px solid var(--primary);
            outline: none;
        }

        /* Boutons */
        .btn {
            width: 100%;
            padding: 15px;
            border-radius: 50px;
            border: none;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            font-weight: bold;
            font-size: 1.1rem;
            cursor: pointer;
            transition: 0.3s;
            box-shadow: 0 10px 20px rgba(139, 92, 246, 0.3);
        }

        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn:hover:not(:disabled) { transform: translateY(-2px); filter: brightness(1.1); }

        /* Loading */
        #loading { display: none; margin-top: 30px; text-align: center; }
        .spinner {
            width: 50px; height: 50px;
            border: 4px solid rgba(255,255,255,0.1);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* R√©sultats */
        #results { display: none; margin-top: 40px; }
        video, audio { width: 100%; border-radius: 12px; margin-bottom: 20px; }
        
        .segments-list {
            background: rgba(0,0,0,0.3);
            padding: 20px;
            border-radius: 12px;
            max-height: 400px;
            overflow-y: auto;
        }

        .segment-item {
            padding: 12px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex;
            gap: 15px;
        }

        .timestamp { color: var(--primary); font-size: 0.85rem; min-width: 90px; }
        .text-content { font-size: 0.95rem; }
    </style>
</head>
<body>

<div class="container">
    <div class="card">
        <h1>üéôÔ∏è Media Subtitler Pro</h1>
        <p class="subtitle">Transcription & Traduction IA pour Vid√©o et Audio</p>

        <div class="upload-section" id="dropZone" onclick="document.getElementById('mediaFile').click()">
            <div id="uploadPrompt">
                <p style="font-size: 1.2rem;">üìÇ Cliquez ou glissez un fichier ici</p>
                <p style="font-size: 0.9rem; color: #888; margin-top: 8px;">MP4, MOV, MP3, WAV, M4A</p>
            </div>
            <div id="fileName" class="file-info"></div>
            <input type="file" id="mediaFile" accept="video/*,audio/*" style="display:none">
        </div>

        <div class="config-grid">
            <div>
                <label style="display:block; margin-bottom:8px;">üåç Traduire en :</label>
                <select id="targetLanguage">
                    <option value="fr">üá´üá∑ Fran√ßais</option>
                    <option value="en">üá¨üáß English</option>
                    <option value="es">üá™üá∏ Espa√±ol</option>
                    <option value="ar">üá∏üá¶ ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
                    <option value="de">üá©üá™ Deutsch</option>
                </select>
            </div>
        </div>

        <button class="btn" id="processBtn" onclick="startProcessing()" disabled>üöÄ Lancer le traitement</button>

        <div id="loading">
            <div class="spinner"></div>
            <p id="statusText">IA en r√©flexion...</p>
        </div>

        <div id="results">
            <h2 style="margin-bottom:15px;">‚ú® R√©sultat</h2>
            <div id="mediaPlayerContainer"></div>
            
            <a id="downloadLink" class="btn" style="display:inline-block; text-align:center; text-decoration:none; margin-bottom:20px; background: #10b981;">
                ‚¨áÔ∏è T√©l√©charger le r√©sultat
            </a>

            <h3>üìù Transcription traduite</h3>
            <div class="segments-list" id="segmentsList"></div>
        </div>
    </div>
</div>

<script>
    const fileInput = document.getElementById('mediaFile');
    const processBtn = document.getElementById('processBtn');
    const fileNameDisplay = document.getElementById('fileName');
    const uploadPrompt = document.getElementById('uploadPrompt');

    fileInput.onchange = () => {
        if (fileInput.files[0]) {
            fileNameDisplay.textContent = "üìÑ Fichier pr√™t : " + fileInput.files[0].name;
            uploadPrompt.style.display = 'none';
            processBtn.disabled = false;
        }
    };

    function formatTime(s) {
        const date = new Date(s * 1000);
        const mm = date.getUTCMinutes();
        const ss = date.getUTCSeconds().toString().padStart(2, '0');
        return `${mm}:${ss}`;
    }

    async function startProcessing() {
        const file = fileInput.files[0];
        const lang = document.getElementById('targetLanguage').value;
        const fd = new FormData();
        fd.append('file', file);
        fd.append('language', lang);

        // UI Update
        document.getElementById('loading').style.display = 'block';
        document.getElementById('results').style.display = 'none';
        processBtn.disabled = true;
        
        const statusText = document.getElementById('statusText');
        statusText.textContent = "üé§ Analyse du m√©dia et traduction...";

        try {
            const response = await fetch('/api/process-media', {
                method: 'POST',
                body: fd
            });

            const data = await response.json();

            if (data.success) {
                showResults(data);
            } else {
                alert("Erreur : " + data.error);
            }
        } catch (e) {
            alert("Erreur r√©seau ou serveur.");
        } finally {
            document.getElementById('loading').style.display = 'none';
            processBtn.disabled = false;
        }
    }

    function showResults(data) {
        const resultsDiv = document.getElementById('results');
        const playerContainer = document.getElementById('mediaPlayerContainer');
        const list = document.getElementById('segmentsList');
        const dl = document.getElementById('downloadLink');

        // Configurer le lecteur (Vid√©o ou Audio)
        if (data.is_audio) {
            playerContainer.innerHTML = `<audio controls src="${data.video_url}"></audio>`;
        } else {
            playerContainer.innerHTML = `<video controls src="${data.video_url}"></video>`;
        }

        dl.href = data.video_url;
        dl.download = "traduction_" + (data.is_audio ? "audio.mp3" : "video.mp4");

        // Liste des segments
        list.innerHTML = data.segments.map(s => `
            <div class="segment-item">
                <div class="timestamp">[${formatTime(s.start)} - ${formatTime(s.end)}]</div>
                <div class="text-content">${s.text}</div>
            </div>
        `).join('');

        resultsDiv.style.display = 'block';
        resultsDiv.scrollIntoView({ behavior: 'smooth' });
    }
</script>

</body>
</html>